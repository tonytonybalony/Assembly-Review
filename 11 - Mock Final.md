這是一份為你準備的**期末考模擬試題**。這份試題 **嚴格模仿** 你提供的期中考題型與難度，範圍涵蓋全學期，但 **加重** 期中考後（第10-14單元）的比重，特別是「堆疊框架」、「函式呼叫」與「流程控制」。

試題共 50 題，分為觀念題、計算題與程式追蹤題。請準備紙筆進行計算。

---

### **113學年度 組合語言與系統程式 期末考試**

**考試時間：** 100分鐘
**說明：** 所有數值若無標示，預設為十進位；標示 H 結尾為十六進位。

#### **一、基礎指令與旗標 (累計範圍)**
1.  執行 `CMP AX, BX` 指令後，實際上 CPU 內部執行了什麼運算來影響旗標？（請寫出運算式，例如 A+B）
2.  若要檢查暫存器 AX 是否為 0，且不改變 AX 的值，可以使用哪一個邏輯運算指令搭配旗標判斷？
3.  執行 `SHL AL, 1` (左移一位) 相當於將 AL 的數值乘以多少？
4.  在 8086 中，執行 16 位元乘法 `MUL BX` 時，結果會儲存在哪兩個暫存器中？（請寫出高位與低位暫存器）
5.  執行 `DIV BL` (8 位元除法) 時，商會存在哪個暫存器？餘數會存在哪個暫存器？
6.  指令 `XOR AX, AX` 執行後，ZF (Zero Flag) 的狀態為何？
7.  若 `AX = FFFFH`，執行 `INC AX` 後，CF (Carry Flag) 的值為何？(注意 INC 特性)
8.  寫出將 AX 的值推入堆疊的完整指令。
9.  8086 的 `RET` 指令是用來從堆疊取出值並放入哪個暫存器，以達成返回原程式的目的？
10. `INT 21H` 的功能是由哪個暫存器的高 8 位 (AH) 來決定的？

#### **二、流程控制 - 選擇與重複 (第10-11單元)**
11. 若要判斷兩個 **無號數 (Unsigned)** 大小，當前者大於後者時跳轉，應使用哪一個跳轉指令 (JA 或 JG)？
12. 若要判斷兩個 **有號數 (Signed)** 大小，當前者小於後者時跳轉，應使用哪一個跳轉指令 (JB 或 JL)？
13. `LOOP` 指令在執行跳轉檢查前，會先將哪個暫存器的值減 1？
14. 若 `CX = 0` 時執行 `LOOP Label` 指令，迴圈將會執行多少次？
15. 寫出一段組合語言指令（不使用 LOOP），實作「將 CX 減 1，若不為 0 則跳至 START」的功能。
16. `JCXZ` 指令主要用來解決什麼特殊的迴圈問題？
17. 指令 `JMP` 是修改了哪個暫存器的值來達到強制跳轉？
18. 若 `AX = 7FFFH` 且 `BX = 8000H`，執行 `CMP AX, BX` 後，視為 **有號數** 比較，AX 是否大於 BX？
19. 承上題，若視為 **無號數** 比較，AX 是否大於 BX？
20. `JNE` (Jump if Not Equal) 指令是檢查哪一個旗標的狀態？

#### **三、函式呼叫與參數傳遞 (第12-13單元 - 重點區)**
21. 當執行 `CALL 1000H` 指令時，`SP` 暫存器的值會增加還是減少？
22. 執行 `CALL` 指令時，壓入堆疊的內容是什麼？
23. 在標準函式呼叫慣例中，建立堆疊框架 (Stack Frame) 的前兩行指令通常是什麼？（提示：保護與設定 BP）
24. 已知 `SS=2000H`, `SP=0100H`，執行 `CALL MyFunc` (Near Call) 後，堆疊頂端的 **實體位址** 為何？
25. 在函式內使用 `[BP+4]` 通常是用來存取什麼資料？(參數 還是 區域變數？)
26. 若函式內需要一個 2 Bytes 的區域變數 (Local Variable)，通常會將 SP 減去多少來預留空間？
27. 指令 `RET 4` 代表在返回後，SP 的值要額外加上多少？
28. 為什麼在存取函式參數時，預設段暫存器是 SS 而不是 DS？(因為使用了哪個暫存器？)
29. 若主程式執行 `PUSH A`、`PUSH B` 然後 `CALL Sum`，在 `Sum` 函式中，`[BP+6]` 對應到的是 A 還是 B？
30. 若未建立 Stack Frame (未設定 BP)，直接在函式內執行 `POP AX`，可能會誤取到什麼重要的資料導致程式崩潰？

#### **四、巨集與模組化 (第14單元)**
31. `MACRO` (巨集) 與 `PROC` (程序) 相比，哪一個執行速度較快（無呼叫開銷）？
32. `MACRO` 與 `PROC` 相比，哪一個編譯後的程式碼體積較大？
33. 在巨集定義中，若包含標籤 (Label)，必須使用哪個假指令來避免「重複定義標籤」的錯誤？
34. 若要在程式中引用另一個檔案 `LIB.INC`，應使用什麼指令？
35. 巨集展開是在「組譯時期」還是「執行時期」發生的？

#### **五、進階計算與程式追蹤 (綜合應用)**
36. 已知 `SS=5000H`, `BP=1000H`, `SI=0010H`，請計算 `MOV AX, [BP+SI+5]` 的來源運算元 **實體位址**。
37. 將 32 位元數值 `12345678H` 存入記憶體位址 `2000H` (小端序)，請問位址 `2002H` 的內容為何？(Hex)
38. 已知 `AX=0010H`，執行 `NEG AX` 後，AX 的十六進位值為何？
39. 計算 8 位元二補數運算：`10000000` (-128) + `11111111` (-1)，結果是否有溢位 (OF=?)？
40. 已知 `DS=1000H`, `BX=0200H`，指令 `LEA AX, [BX+10H]` 執行後，AX 的值為何？
41. 若 `IP=0100H`，執行一條長度為 3 Bytes 的 `CALL` 指令，請問壓入堆疊的返回位址 (Offset) 是多少？
42. `MOV AX, [BX+DI]` 屬於哪一種定址法？
43. 執行以下程式片段後，AX 的值為何？
    ```assembly
    MOV CX, 3
    MOV AX, 0
    L1: ADD AX, 2
    LOOP L1
    ```
44. 執行以下程式片段後，BX 的值為何？
    ```assembly
    MOV BX, 0
    MOV CX, 0
    DEC CX       ; CX 變為 FFFF
    INC BX
    JZ  EXIT     ; 檢查 ZF
    ADD BX, 1    ; 若沒跳轉則執行
    EXIT:
    ```
45. 已知 `SP=00FEH`，執行 `RET` 指令後，SP 的新值為何？
46. 寫出一個能將 `AX` 的第 3 個位元 (bit 3) 強制設為 1，其餘位元不變的指令。
47. 寫出一個能將 `BX` 的最低位元 (bit 0) 清除為 0，其餘位元不變的指令。
48. 在字串處理指令 `REP MOVSB` 中，重複次數由哪個暫存器控制？
49. 函式 `MyFunc` 結束前執行 `MOV SP, BP` 的主要目的是什麼？
50. (壓軸題) 請計算以下堆疊操作後的 `AX` 值：
    ```assembly
    MOV AX, 10
    MOV BX, 20
    PUSH AX
    PUSH BX
    POP AX
    POP BX
    ADD AX, BX
    ```

---

### **參考答案**

#### **一、基礎指令與旗標**
1.  **AX - BX** (減法，但不存結果)
2.  **TEST AX, AX** (或 `OR AX, AX` / `AND AX, AX`)
3.  **2**
4.  **DX** (高位), **AX** (低位)
5.  商：**AL**，餘數：**AH**
6.  **1** (結果為 0)
7.  **不變** (INC 指令不影響 CF 旗標)
8.  **PUSH AX**
9.  **IP** (Instruction Pointer)
10. **AH**

#### **二、流程控制**
11. **JA** (Jump Above)
12. **JL** (Jump Less)
13. **CX**
14. **65536 次** (0先減1變FFFF，不為0繼續跑)
15. **DEC CX** 接著 **JNZ START**
16. **CX 初始值為 0** 導致的錯誤迴圈 (預先檢查 CX 是否為 0)
17. **IP**
18. **是** (7FFFH是正大數，8000H是負數-32768)
19. **否** (7FFFH < 8000H)
20. **ZF** (Zero Flag，檢查 ZF=0)

#### **三、函式呼叫與參數傳遞**
21. **減少** (SP = SP - 2)
22. **IP** (下一條指令的偏移位址)
23. **PUSH BP**, **MOV BP, SP**
24. **200FEH** (SS:SP-2 => 20000H + 0100H - 2H)
25. **參數 (Argument)**
26. **2** (SUB SP, 2)
27. **4** (除了 POP IP 的 +2 外，再加 4)
28. **BP** (BP 預設搭配 SS 段)
29. **A** (先進堆疊的位址較大，[BP+4]是B，[BP+6]是A)
30. **返回位址 (Return Address/IP)**

#### **四、巨集與模組化**
31. **MACRO** (直接展開，無跳轉)
32. **MACRO** (程式碼重複貼上)
33. **LOCAL**
34. **INCLUDE**
35. **組譯時期 (Assembly Time)**

#### **五、進階計算與程式追蹤**
36. **51015H** (SS * 10H + BP + SI + 5 = 50000 + 1000 + 10 + 5)
37. **56H** (2000:78, 2001:56, 2002:34, 2003:12 -> 題目問 2002H 內容，應為 **34H** *修正：32位元數 12345678H，低位 78 在 2000，56 在 2001，34 在 2002，12 在 2003。*) -> **正確答案是 34H**
38. **FFF0H** (0000 - 0010 = FFF0)
39. **OF=1** (溢位，-128 + -1 = -129，超出 8 bit 有號數範圍)
40. **0210H** (LEA 取有效位址：BX+10H = 0200+10)
41. **0103H** (0100H + 3)
42. **基底索引定址法 (Base Indexed Addressing)**
43. **6** (2 * 3次)
44. **2** (DEC CX 影響 ZF=0, JZ 不跳, 執行 ADD BX, 1。原本 BX=1, 再加 1 變 2)
45. **0100H** (SP + 2)
46. **OR AX, 08H** (或 `OR AX, 00001000B`)
47. **AND BX, FFFEH** (或 `AND BX, 11111110B`)
48. **CX**
49. **恢復堆疊指標 (Stack Balance)** / 釋放區域變數空間
50. **30** (Stack: [10, 20] -> POP AX=20 -> POP BX=10 -> AX+BX = 30)

祝你期末考順利 High Pass！